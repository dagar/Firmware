#! /bin/sh

set -o xtrace

@JLinkGDBServerExe_PATH@ -device @DEBUG_DEVICE@ -select usb -endian little -if SWD -speed auto -ir -LocalhostOnly 1 -strict -vd -singlerun &

@CMAKE_GDB@ -nh --silent --cd=@PX4_BINARY_DIR@ \
	-iex "set auto-load safe-path @PX4_BINARY_DIR@" \
	-ex "target remote localhost:2331" \
	-ex "monitor reset 0" \
	-ex "load" \
	-ex "monitor reset 0" \
	-ex "source -v /home/dagar/git/Firmware/platforms/nuttx/Debug/hardfault.cmd" \
	-ex "continue" \
	@PX4_BINARY_DIR@/@PX4_CONFIG@.elf
