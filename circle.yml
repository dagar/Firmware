machine:
  services:
    - docker

checkout:
  post:
    # workaround for known git bug where attempting to fetch a mission commit fails too early
    - git submodule update --init || true
    - git submodule sync --recursive
    - git submodule update --init --recursive

test:
  override:
    - ./Tools/docker_run.sh 'make posix_sitl_default'
    - ./Tools/docker_run.sh 'make px4fmu-v4_default'
    - ./Tools/docker_run.sh 'make tests'

general:
  artifacts:
    - "build_px4fmu-v4_default/parameters.xml"
    - "build_px4fmu-v4_default/airframes.xml"
    - "build_px4fmu-v4_default/src/firmware/nuttx/px4fmu-v4_default.px4"
